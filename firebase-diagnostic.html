<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Configuration Diagnostic</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; }
        .diagnostic-section { background: #f8f9fa; padding: 20px; margin: 20px 0; border-radius: 8px; border-left: 4px solid #007bff; }
        .error { background: #f8d7da; border-left-color: #dc3545; color: #721c24; }
        .success { background: #d4edda; border-left-color: #28a745; color: #155724; }
        .warning { background: #fff3cd; border-left-color: #ffc107; color: #856404; }
        .test-btn { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .test-btn:hover { background: #0056b3; }
        .test-btn:disabled { background: #6c757d; cursor: not-allowed; }
        .log { background: #f1f1f1; padding: 15px; margin: 10px 0; border-radius: 5px; font-family: monospace; font-size: 12px; max-height: 400px; overflow-y: auto; }
        .config-display { background: #e9ecef; padding: 15px; margin: 10px 0; border-radius: 5px; font-family: monospace; font-size: 12px; }
        .step { margin: 10px 0; padding: 10px; background: #e7f3ff; border-radius: 5px; }
        .step-number { background: #007bff; color: white; border-radius: 50%; width: 25px; height: 25px; display: inline-flex; align-items: center; justify-content: center; margin-right: 10px; }
    </style>
</head>
<body>
    <h1>üîç Firebase Configuration Diagnostic Tool</h1>
    <p>This tool will help diagnose and fix your Firebase Authentication configuration issue.</p>

    <div class="diagnostic-section">
        <h3>üìã Current Configuration</h3>
        <div id="config-display" class="config-display"></div>
    </div>

    <div class="diagnostic-section">
        <h3>üß™ Diagnostic Tests</h3>
        <button id="test-app-init" class="test-btn">Test Firebase App Initialization</button>
        <button id="test-auth-service" class="test-btn">Test Auth Service</button>
        <button id="test-firestore" class="test-btn">Test Firestore</button>
        <button id="test-project-access" class="test-btn">Test Project Access</button>
    </div>

    <div class="diagnostic-section">
        <h3>üìä Test Results</h3>
        <div id="test-results"></div>
    </div>

    <div class="diagnostic-section">
        <h3>üõ†Ô∏è Step-by-Step Fix Instructions</h3>
        
        <div class="step">
            <span class="step-number">1</span>
            <strong>Go to Firebase Console</strong><br>
            Visit: <a href="https://console.firebase.google.com/project/uncle-ali-piano" target="_blank">https://console.firebase.google.com/project/uncle-ali-piano</a>
        </div>

        <div class="step">
            <span class="step-number">2</span>
            <strong>Enable Authentication</strong><br>
            ‚Ä¢ Click "Authentication" in the left sidebar<br>
            ‚Ä¢ If you see "Get started", click it to initialize Authentication<br>
            ‚Ä¢ This step is CRITICAL - Authentication must be initialized first
        </div>

        <div class="step">
            <span class="step-number">3</span>
            <strong>Configure Sign-in Methods</strong><br>
            ‚Ä¢ Go to "Sign-in method" tab<br>
            ‚Ä¢ Click "Email/Password" ‚Üí Toggle Enable ‚Üí Save<br>
            ‚Ä¢ Click "Google" ‚Üí Toggle Enable ‚Üí Enter support email ‚Üí Save
        </div>

        <div class="step">
            <span class="step-number">4</span>
            <strong>Check Authorized Domains</strong><br>
            ‚Ä¢ Go to "Settings" tab in Authentication<br>
            ‚Ä¢ Scroll to "Authorized domains"<br>
            ‚Ä¢ Ensure these domains are listed:<br>
            &nbsp;&nbsp;- localhost<br>
            &nbsp;&nbsp;- uncle-ali-piano.firebaseapp.com<br>
            &nbsp;&nbsp;- uncle-ali-piano.web.app
        </div>

        <div class="step">
            <span class="step-number">5</span>
            <strong>Verify Project Settings</strong><br>
            ‚Ä¢ Go to Project Settings (gear icon)<br>
            ‚Ä¢ Check that your app is listed under "Your apps"<br>
            ‚Ä¢ Verify the App ID matches: 1:639101542865:web:e4ace865b05d78f0a8c0f0
        </div>
    </div>

    <div class="diagnostic-section">
        <h3>üìù Debug Log</h3>
        <div id="debug-log" class="log"></div>
    </div>

    <script type="module">
        let app, auth, db;
        
        const firebaseConfig = {
            apiKey: "AIzaSyCIqEzxusl4VtVfODqTafgAi22U8AkIDbo",
            authDomain: "uncle-ali-piano.firebaseapp.com",
            projectId: "uncle-ali-piano",
            storageBucket: "uncle-ali-piano.firebasestorage.app",
            messagingSenderId: "639101542865",
            appId: "1:639101542865:web:e4ace865b05d78f0a8c0f0",
            measurementId: "G-GLDW02K380"
        };

        // Display current configuration
        document.getElementById('config-display').innerHTML = `
            <strong>Project ID:</strong> ${firebaseConfig.projectId}<br>
            <strong>Auth Domain:</strong> ${firebaseConfig.authDomain}<br>
            <strong>App ID:</strong> ${firebaseConfig.appId}<br>
            <strong>API Key:</strong> ${firebaseConfig.apiKey.substring(0, 20)}...<br>
            <strong>SDK Version:</strong> 12.3.0
        `;

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('debug-log');
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : type === 'warning' ? 'orange' : 'black';
            logDiv.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span><br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function addResult(test, status, message) {
            const resultsDiv = document.getElementById('test-results');
            const statusClass = status === 'success' ? 'success' : status === 'error' ? 'error' : 'warning';
            const icon = status === 'success' ? '‚úÖ' : status === 'error' ? '‚ùå' : '‚ö†Ô∏è';
            
            resultsDiv.innerHTML += `
                <div class="diagnostic-section ${statusClass}">
                    <strong>${icon} ${test}</strong><br>
                    ${message}
                </div>
            `;
        }

        // Test Firebase App Initialization
        document.getElementById('test-app-init').addEventListener('click', async () => {
            try {
                log('Testing Firebase App initialization...');
                const { initializeApp } = await import("https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js");
                app = initializeApp(firebaseConfig);
                log('‚úÖ Firebase App initialized successfully', 'success');
                addResult('Firebase App Initialization', 'success', 'Firebase app is properly configured and initialized.');
            } catch (error) {
                log(`‚ùå Firebase App initialization failed: ${error.message}`, 'error');
                addResult('Firebase App Initialization', 'error', `Failed: ${error.message}`);
            }
        });

        // Test Auth Service
        document.getElementById('test-auth-service').addEventListener('click', async () => {
            try {
                if (!app) {
                    throw new Error('Firebase App not initialized. Run App initialization test first.');
                }
                
                log('Testing Auth service...');
                const { getAuth } = await import("https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js");
                auth = getAuth(app);
                
                // Try to access auth properties
                log(`Auth instance created. Current user: ${auth.currentUser ? auth.currentUser.email : 'None'}`);
                log('‚úÖ Auth service accessible', 'success');
                addResult('Authentication Service', 'success', 'Auth service is accessible. The issue might be that Authentication is not enabled in Firebase Console.');
                
            } catch (error) {
                log(`‚ùå Auth service test failed: ${error.message}`, 'error');
                addResult('Authentication Service', 'error', `Failed: ${error.message}<br><br><strong>This error usually means Authentication is not enabled in your Firebase Console.</strong>`);
            }
        });

        // Test Firestore
        document.getElementById('test-firestore').addEventListener('click', async () => {
            try {
                if (!app) {
                    throw new Error('Firebase App not initialized. Run App initialization test first.');
                }
                
                log('Testing Firestore...');
                const { getFirestore, doc, getDoc } = await import("https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js");
                db = getFirestore(app);
                
                // Try to read a document
                const testDoc = doc(db, 'test', 'connection');
                await getDoc(testDoc);
                
                log('‚úÖ Firestore connection successful', 'success');
                addResult('Firestore Database', 'success', 'Firestore is properly configured and accessible.');
                
            } catch (error) {
                log(`‚ùå Firestore test failed: ${error.message}`, 'error');
                addResult('Firestore Database', 'error', `Failed: ${error.message}`);
            }
        });

        // Test Project Access
        document.getElementById('test-project-access').addEventListener('click', async () => {
            try {
                log('Testing project access and configuration...');
                
                // Test API key validity by making a basic request
                const response = await fetch(`https://identitytoolkit.googleapis.com/v1/projects?key=${firebaseConfig.apiKey}`);
                
                if (response.ok) {
                    log('‚úÖ API key is valid and project is accessible', 'success');
                    addResult('Project Access', 'success', 'API key is valid and project is accessible.');
                } else {
                    const errorData = await response.json();
                    log(`‚ùå Project access failed: ${response.status} - ${errorData.error?.message}`, 'error');
                    addResult('Project Access', 'error', `Failed: ${response.status} - ${errorData.error?.message || 'Unknown error'}`);
                }
                
            } catch (error) {
                log(`‚ùå Project access test failed: ${error.message}`, 'error');
                addResult('Project Access', 'error', `Failed: ${error.message}`);
            }
        });

        // Auto-run all tests
        log('üöÄ Firebase Diagnostic Tool initialized');
        log('Click the test buttons above to diagnose your Firebase configuration');
        
    </script>
</body>
</html>