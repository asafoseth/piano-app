<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- iOS-friendly viewport that allows pinch-to-zoom -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=3.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>iOS Pinch-Zoom Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(160deg, #1a1a2e 0%, #3a204a 100%);
            color: white;
            min-height: 100vh;
            /* Enable touch-action for zoom gestures */
            touch-action: pan-x pan-y pinch-zoom;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .piano-container {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            /* Allow zoom and pan */
            transform-origin: top left;
        }
        
        .piano-keys {
            display: flex;
            flex-wrap: nowrap;
            min-width: max-content;
            gap: 2px;
            justify-content: center;
        }
        
        .key {
            width: 40px;
            height: 120px;
            border: 2px solid #333;
            border-radius: 0 0 8px 8px;
            cursor: pointer;
            transition: all 0.1s ease;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            padding-bottom: 10px;
            /* Prevent text selection but allow touch gestures */
            -webkit-user-select: none;
            user-select: none;
        }
        
        .key.white {
            background: linear-gradient(to bottom, #fff 0%, #f0f0f0 100%);
            color: #333;
        }
        
        .key.black {
            background: linear-gradient(to bottom, #333 0%, #000 100%);
            color: #fff;
            height: 80px;
            width: 30px;
            margin: 0 -15px;
            z-index: 2;
        }
        
        .key:hover {
            transform: translateY(2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .key.pressed {
            transform: translateY(4px);
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
        
        .zoom-instruction {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid #4CAF50;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .status.success { background: rgba(76, 175, 80, 0.3); color: #4CAF50; }
        .status.warning { background: rgba(255, 193, 7, 0.3); color: #FFC107; }
        .status.info { background: rgba(33, 150, 243, 0.3); color: #2196F3; }
        
        .gesture-log {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üéπ iOS Pinch-Zoom Test</h1>
        <p>This page tests if pinch-to-zoom works properly on iOS devices while maintaining piano functionality.</p>
        
        <div class="zoom-instruction">
            <h3>üì± How to Test Pinch-Zoom:</h3>
            <ol>
                <li><strong>Pinch-to-zoom on this text</strong> - Should zoom in/out smoothly</li>
                <li><strong>Double-tap anywhere</strong> - Should zoom in/out (except on input fields)</li>
                <li><strong>Pinch-to-zoom on the piano</strong> - Should zoom the entire piano</li>
                <li><strong>Touch piano keys</strong> - Should play sounds without interfering with zoom</li>
                <li><strong>Try zooming while touching keys</strong> - Piano should still work at any zoom level</li>
            </ol>
        </div>
        
        <div id="device-info" class="status info">
            <strong>Device Info:</strong> <span id="device-details">Loading...</span>
        </div>
        
        <div class="test-section">
            <h3>üéπ Test Piano (Simplified)</h3>
            <p>Try touching these keys and also try pinch-zooming on them:</p>
            
            <div class="piano-container">
                <div class="piano-keys" id="piano-keys">
                    <!-- Keys will be generated by JavaScript -->
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>üìä Gesture Detection Log</h3>
            <div id="gesture-log" class="gesture-log">
                Waiting for gestures...\n
            </div>
            <button onclick="clearLog()" style="padding: 8px 16px; background: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer;">Clear Log</button>
        </div>
        
        <div class="test-section">
            <h3>üìù Test Results</h3>
            <div id="test-results">
                <div class="status warning">
                    <strong>Zoom Test:</strong> Try pinch-to-zoom gestures above to see if they work
                </div>
                <div class="status warning">
                    <strong>Piano Test:</strong> Try touching piano keys to see if they respond
                </div>
            </div>
        </div>
    </div>

    <script>
        let gestureLog = document.getElementById('gesture-log');
        let zoomTested = false;
        let pianoTested = false;
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            gestureLog.textContent += `[${timestamp}] ${message}\n`;
            gestureLog.scrollTop = gestureLog.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            gestureLog.textContent = 'Log cleared...\n';
        }
        
        function updateTestResults() {
            const resultsDiv = document.getElementById('test-results');
            let html = '';
            
            if (zoomTested) {
                html += '<div class="status success"><strong>Zoom Test:</strong> ‚úÖ Pinch-zoom gestures detected and working!</div>';
            } else {
                html += '<div class="status warning"><strong>Zoom Test:</strong> ‚è≥ Try pinch-to-zoom gestures to test</div>';
            }
            
            if (pianoTested) {
                html += '<div class="status success"><strong>Piano Test:</strong> ‚úÖ Piano keys responding to touch!</div>';
            } else {
                html += '<div class="status warning"><strong>Piano Test:</strong> ‚è≥ Try touching piano keys to test</div>';
            }
            
            resultsDiv.innerHTML = html;
        }
        
        // Detect device and browser
        function detectDevice() {
            const userAgent = navigator.userAgent;
            const isIOS = /iPad|iPhone|iPod/.test(userAgent);
            const isSafari = /Safari/.test(userAgent) && !/Chrome/.test(userAgent);
            const isChrome = /Chrome/.test(userAgent);
            const isFirefox = /Firefox/.test(userAgent);
            
            let deviceInfo = '';
            if (isIOS) {
                deviceInfo += 'üì± iOS Device ‚Ä¢ ';
                if (isSafari) deviceInfo += 'ü¶Å Safari';
                else if (isChrome) deviceInfo += 'üåê Chrome';
                else deviceInfo += '‚ùì Other Browser';
            } else {
                deviceInfo += 'üíª Non-iOS Device ‚Ä¢ ';
                if (isChrome) deviceInfo += 'üåê Chrome';
                else if (isFirefox) deviceInfo += 'ü¶ä Firefox';
                else if (isSafari) deviceInfo += 'ü¶Å Safari';
                else deviceInfo += '‚ùì Other Browser';
            }
            
            deviceInfo += ` ‚Ä¢ Viewport: ${window.innerWidth}√ó${window.innerHeight}`;
            document.getElementById('device-details').textContent = deviceInfo;
            
            log(`Device detected: ${deviceInfo}`);
        }
        
        // Create piano keys
        function createPiano() {
            const pianoKeys = document.getElementById('piano-keys');
            const keyPattern = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
            
            for (let i = 0; i < 12; i++) {
                const key = document.createElement('div');
                key.className = keyPattern[i].includes('#') ? 'key black' : 'key white';
                key.textContent = keyPattern[i];
                key.setAttribute('data-note', keyPattern[i]);
                
                key.addEventListener('touchstart', (e) => {
                    // Only handle if touching this specific key
                    if (e.target === key) {
                        e.preventDefault(); // Prevent scrolling only on piano keys
                        key.classList.add('pressed');
                        log(`üéπ Piano key touched: ${keyPattern[i]}`);
                        pianoTested = true;
                        updateTestResults();
                    }
                }, { passive: false });
                
                key.addEventListener('touchend', (e) => {
                    key.classList.remove('pressed');
                    log(`üéπ Piano key released: ${keyPattern[i]}`);
                }, { passive: true });
                
                key.addEventListener('mousedown', (e) => {
                    key.classList.add('pressed');
                    log(`üñ±Ô∏è Piano key clicked: ${keyPattern[i]}`);
                    pianoTested = true;
                    updateTestResults();
                });
                
                key.addEventListener('mouseup', (e) => {
                    key.classList.remove('pressed');
                });
                
                pianoKeys.appendChild(key);
            }
        }
        
        // Gesture detection
        document.addEventListener('gesturestart', function(e) {
            log(`üìå Pinch gesture started (scale: ${e.scale})`);
            zoomTested = true;
            updateTestResults();
        }, { passive: true });
        
        document.addEventListener('gesturechange', function(e) {
            log(`üîÑ Pinch gesture changing (scale: ${e.scale.toFixed(2)})`);
        }, { passive: true });
        
        document.addEventListener('gestureend', function(e) {
            log(`üìç Pinch gesture ended (scale: ${e.scale.toFixed(2)})`);
        }, { passive: true });
        
        // Touch events for additional detection
        let touches = 0;
        document.addEventListener('touchstart', function(e) {
            touches = e.touches.length;
            if (touches >= 2) {
                log(`üëÜ Multi-touch detected (${touches} fingers)`);
                zoomTested = true;
                updateTestResults();
            }
        }, { passive: true });
        
        document.addEventListener('touchend', function(e) {
            touches = e.touches.length;
        }, { passive: true });
        
        // Double-tap detection
        let lastTap = 0;
        document.addEventListener('touchend', function(e) {
            const now = Date.now();
            if (now - lastTap < 300) {
                log(`üëÜüëÜ Double-tap detected`);
                // Don't mark as zoom tested since we modified double-tap behavior
            }
            lastTap = now;
        }, { passive: true });
        
        // Zoom detection via resize
        let lastViewportWidth = window.innerWidth;
        window.addEventListener('resize', function() {
            const newWidth = window.innerWidth;
            if (Math.abs(newWidth - lastViewportWidth) > 50) {
                log(`üìè Viewport size changed: ${lastViewportWidth} ‚Üí ${newWidth} (possible zoom)`);
                zoomTested = true;
                updateTestResults();
            }
            lastViewportWidth = newWidth;
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            detectDevice();
            createPiano();
            updateTestResults();
            log('üöÄ Pinch-zoom test page loaded and ready');
            
            // Test instructions for iOS
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            if (isIOS) {
                log('üì± iOS detected - pinch-zoom should work with two fingers');
                log('üí° Try: pinch with two fingers, double-tap, touch piano keys');
            } else {
                log('üíª Non-iOS device - test zoom with browser controls or gestures');
            }
        });
    </script>
</body>
</html>